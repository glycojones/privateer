var CCP4Module,RDKit;function makeRequest(o,e){return new Promise((function(t,_){var c=new XMLHttpRequest;c.open(o,e,!0),c.onload=function(){this.status>=200&&this.status<300?t(c.response):_({status:this.status,statusText:c.statusText})},c.onerror=function(){_({status:this.status,statusText:c.statusText})},c.send()}))}function onlyUnique(o,e,t){return t.indexOf(o)===e}function getLoop(o,e){let t=e+".",_=!1,c=[],n=o.length;for(let e=0;e<n;e++){let n=o[e].replace(/(^\s+|\s+$)/g,"");if("loop_"===n||"_"===n.substring(0,1)&&n.substring(0,t.length)!==t){if(_)break;e<o.length&&o[e+1].substring(0,t.length)===t&&(_=!0)}else _&&c.push(n)}return c}function splitQuotedCIFString(o){return 0===o.length?[]:o.match(/(?:[^\s"]+|"[^"]*")+/g)}function addCIFAtomTypes(o,e){let t=[],_=getLoop(e.split("\n"),"_chem_comp_atom"),c=[];for(let o=0;o<_.length;o++)if("#"!==_[o].substr(0,1)&&""!==_[o].trim())if("_"===_[o].substr(0,1))t.push(_[o]);else{let e=splitQuotedCIFString(_[o]);if("."!==e[0]){let o={};for(let _=0;_<e.length;_++)o[t[_]]=e[_];c.push(o)}}return c}function addCIFBondTypes(o,e){let t=[],_=getLoop(e.split("\n"),"_chem_comp_bond"),c=[];for(let o=0;o<_.length;o++)if("#"!==_[o].substr(0,1)&&""!==_[o].trim())if("_"===_[o].substr(0,1))t.push(_[o]);else{let e=_[o].match(/(?:[^\s"]+|"[^"]*")+/g);if("."!==e[0]){let o={};for(let _=0;_<e.length;_++)o[t[_]]=e[_];void 0!==o["_chem_comp_bond.type"]&&o["_chem_comp_bond.type"].length>0&&void 0!==o["_chem_comp_bond.comp_id"]&&o["_chem_comp_bond.comp_id"].length>0&&void 0!==o["_chem_comp_bond.atom_id_1"]&&o["_chem_comp_bond.atom_id_1"].length>0&&void 0!==o["_chem_comp_bond.atom_id_2"]&&o["_chem_comp_bond.atom_id_2"].length>0?c.push(o):void 0!==o["_chem_comp_bond.value_order"]&&o["_chem_comp_bond.value_order"].length>0&&void 0!==o["_chem_comp_bond.comp_id"]&&o["_chem_comp_bond.comp_id"].length>0&&void 0!==o["_chem_comp_bond.atom_id_1"]&&o["_chem_comp_bond.atom_id_1"].length>0&&void 0!==o["_chem_comp_bond.atom_id_2"]&&o["_chem_comp_bond.atom_id_2"].length>0&&("Y"===o["_chem_comp_bond.pdbx_aromatic_flag"]?o["_chem_comp_bond.type"]="aromatic":"SING"===o["_chem_comp_bond.value_order"]||"SINGLE"===o["_chem_comp_bond.value_order"]?o["_chem_comp_bond.type"]="single":"DOUB"===o["_chem_comp_bond.value_order"]||"DOUBLE"===o["_chem_comp_bond.value_order"]?o["_chem_comp_bond.type"]="double":"TRIP"===o["_chem_comp_bond.value_order"]||"TRIPLE"===o["_chem_comp_bond.value_order"]?o["_chem_comp_bond.type"]="triple":o["_chem_comp_bond.type"]="single",c.push(o))}}return c}function dictToMolBlock(o,e){let t=addCIFAtomTypes(o,e),_=addCIFBondTypes(o,e),c=t.length,n=_.length,m=o+"\n  CCP4-MonomerLibrary-WebToCif\n\n";m+=("  "+c).slice(-3)+("  "+n).slice(-3)+"  0  0  0  0  0  0  0  0999 V2000\n";let s=0,l="";for(let o=0;o<c;o++){let e=parseFloat(t[o]["_chem_comp_atom.x"]),_=parseFloat(t[o]["_chem_comp_atom.y"]),c=parseFloat(t[o]["_chem_comp_atom.z"]);"."!=t[o]["_chem_comp_atom.charge"]&&"0"!=t[o]["_chem_comp_atom.charge"]&&(s++,l+=("   "+(o+1)).slice(-4)+("   "+t[o]["_chem_comp_atom.charge"]).slice(-4));let n=t[o]["_chem_comp_atom.type_symbol"];m+=("          "+e.toFixed(4)).slice(-10)+("          "+_.toFixed(4)).slice(-10)+("          "+c.toFixed(4)).slice(-10)+("   "+n).slice(-3)+"   0  0  0  0  0  0  0  0  0  0  0  0\n"}for(let o=0;o<n;o++){let e=t.find((e=>e["_chem_comp_atom.atom_id"]===_[o]["_chem_comp_bond.atom_id_1"])),c=t.find((e=>e["_chem_comp_atom.atom_id"]===_[o]["_chem_comp_bond.atom_id_2"])),n=t.indexOf(e),s=t.indexOf(c),l=("  "+(n+1)).slice(-3),p=("  "+(s+1)).slice(-3),i=1;!(["_chem_comp_bond.aromatic"]in _[o])||"y_XXX"!==_[o]["_chem_comp_bond.aromatic"]&&"Y_XXX"!==_[o]["_chem_comp_bond.aromatic"]?!(["_chem_comp_bond.type"]in _[o])||"TRIPLE"!==_[o]["_chem_comp_bond.type"]&&"triple"!==_[o]["_chem_comp_bond.type"]?!(["_chem_comp_bond.type"]in _[o])||"DOUBLE"!==_[o]["_chem_comp_bond.type"]&&"double"!==_[o]["_chem_comp_bond.type"]?!(["_chem_comp_bond.type"]in _[o])||"SINGLE"!==_[o]["_chem_comp_bond.type"]&&"single"!==_[o]["_chem_comp_bond.type"]?(console.log("Unknown bond type"),console.log(_[o])):i=1:i=2:i=3:i=4,m+=l+p+("  "+i).slice(-2)+" 0  0  0  0\n"}return s>0&&(m+="M  CHG"+("   "+s).slice(-3)+l+"\n"),m+="M  END",m}importScripts("web_example.js","RDKit_minimal.js"),createCCP4Module({print(o){postMessage(["output",o])},printErr(o){postMessage(["output",o])}}).then((function(o){CCP4Module=o})).catch((o=>{console.log("CCP4 problem :("),console.log(o)})),initRDKitModule({print(o){postMessage(["output",o])},printErr(o){postMessage(["output",o])}}).then((function(o){RDKit=o})).catch((o=>{console.log("RDKit problem :("),console.log(o)})),onmessage=function(o){let e=[o.data[0]],t=[o.data[1]];console.log(e);let _={};e.length>0&&Promise.all(e).then((o=>{console.log("Do RDKit stuff");let e=RDKit.get_mol(o[0]),c=RDKit.get_mol(e.add_hs());console.log("Done get_mol"),_[t[0]]=c.get_svg(),console.log("Done get_svg"),postMessage(["result",_]),console.log("Done postMessage")})).catch((o=>{console.error(o),postMessage(["result",_])}))};